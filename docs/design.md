# 設計書 (Design Document)

## 1. 基本設計 (Basic Design)

### 1.1 概要と目的
`docs/requirements.md` に基づき、お支払い情報画面 (`BillingTemplate.tsx`) の改修を行う。
Figmaデザイン（`docs/figma/Billing.png`）に準拠し、クレジットカード情報の表示、お支払い履歴の確認、およびカード情報編集（UIのみ）を可能にする。

### 1.2 アーキテクチャ方針
- **Frontend Only**: API未接続のため、ReactのローカルStateとモックデータを使用して動作を完結させる。
- **分離の原則**: 表示ロジック（UI）とデータ取得・加工ロジック（Mock Data）を分離し、将来的なAPI連携を容易にする。
- **信頼性**: nullチェック、数値フォーマット、日付フォーマットを徹底し、信頼性の高い表示を実現する。

### 1.3 処理フロー
1.  **初期表示**: クレジットカード情報、お支払い履歴、次回お支払い予定のモックデータをロードして表示。
2.  **画面戻る操作**: ヘッダーの「＜ お支払い情報」をタップし、直前の画面へ戻る。
3.  **カード編集**: 「カード情報を変更する」タップで編集モーダルを表示（UIのみ）。
4.  **PDF出力**: 「領収書 / PDF」ボタンタップで、履歴全件を対象としたPDF出力処理（モック）を呼び出す。

## 2. 詳細設計 (Detailed Design)

### 2.1 状態管理 (State Definition)
以下のState変数を定義し、画面の状態を制御する。

| State変数 | 型 | 初期値 | 説明 |
| :--- | :--- | :--- | :--- |
| `isCardModalOpen` | `boolean` | `false` | カード情報編集モーダルの開閉状態 |
| `cardInfo` | `object` | (Mock) | ブランド、マスクされた番号、有効期限 |
| `paymentHistory` | `Array` | (Mock) | 支払い年月日、金額のリスト |
| `nextPayment` | `object | null` | (Mock) | 次回お支払い日、金額 |

### 2.2 ロジック詳細
- **数値フォーマット (`formatCurrency`)**:
    - `Intl.NumberFormat` を使用し、「¥123,456」の形式に変換。
- **日付フォーマット (`formatDate`)**:
    - `YYYY/MM/DD` 形式を保証。
- **PDF出力処理 (`handleExportPDF`)**:
    - `paymentHistory` を全件取得し、PDF生成ロジック（現状はモックの `console.log` 等）を呼び出す。
- **画面遷移**:
    - `next/router` の `router.back()` を使用。

### 2.3 UI実装方針
- **ヘッダー**:
    - 「＜ お支払い情報」というテキストボタン形式。
- **クレジットカード情報**:
    - カード番号は下4桁以外をマスク（例：`**** **** **** 1234`）。
    - 編集ボタンはアウトライン形式またはフラット形式（Figma準拠）。
- **お支払い履歴一覧**:
    - `map` 関数を使用してリストレンダリング。
    - 「領収書 / PDF」ボタンは一覧の一番上に配置（一括出力用）。
- **次回お支払い表示**:
    - 履歴一覧の最下部に中央寄せで配置。
    - テキストカラーをグレー (`text-gray-500` 等) に設定。
    - データ不在時は「次回のお支払い予定はありません」を表示。

### 2.4 データ定義 (Mock)
以下の構造でモックデータを定義する。
```typescript
const MOCK_BILLING_DATA = {
  card: { brand: 'Visa', last4: '1234', expiry: '12/28' },
  history: [
    { date: '2026/01/01', amount: 33000 },
    { date: '2025/12/01', amount: 33000 },
  ],
  next: { date: '2026/02/01', amount: 33000 }
};
```